#!/usr/bin/env bash

set -e

USER=$1
USER_UID="1000"
USER_GID=$USER_UID
HOME="/home/$USER"

# Create user
groupadd --gid $USER_GID $USER \
	&& useradd --uid $USER_UID --gid $USER_GID -m $USER

# Grant user superuser privileges
apt-get update -y \
	&& apt-get install -y \
	sudo \
	&& echo "$USER ALL=(root) NOPASSWD:ALL" > "/etc/sudoers.d/$USER" \
	&& chmod 0440 "/etc/sudoers.d/$USER"

# Install packages
apt-get update -y \
	&& apt-get install -y \
	curl \
	jq \
	less \
	neovim

# Install Oh My Zsh
OMZ_REPOSITORY="https://github.com/ohmyzsh/ohmyzsh.git"
ZSH_SYNTAX_HIGHLIGHTER_REPOSITORY="https://github.com/zsh-users/zsh-syntax-highlighting.git"

apt-get update -y \
	&& apt-get install -y \
	zsh \
	&& git clone $OMZ_REPOSITORY "$HOME/.oh-my-zsh" \
	&& git clone $ZSH_SYNTAX_HIGHLIGHTER_REPOSITORY "$HOME/.oh-my-zsh/custom/plugins/zsh-syntax-highlighting"

# Copy dotfiles
DOTFILES="/tmp/dotfiles"
cp "$DOTFILES/.tmux.conf" "$HOME/.tmux.conf" \
	&& cp "$DOTFILES/.zshrc" "$HOME/.zshrc" \
	&& rm -R $DOTFILES 

# Remove cache
rm -Rf "/var/lib/apt/lists/*"
